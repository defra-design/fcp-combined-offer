{% extends "layouts/main.html" %}

{% block pageTitle %}
  Capital Claims – {{ serviceName }} – GOV.UK Prototype Kit
{% endblock %}

{% block beforeContent %}

{% from "govuk/components/phase-banner/macro.njk" import govukPhaseBanner %}

{{ govukPhaseBanner({
  tag: {
    text: "Prototype"
  },
  html: 'This is a prototype used for testing purposes only.'
}) }}
  {{ govukBackLink({
    text: "Back",
    href: "javascript:window.history.back()"
  }) }}

  <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">
  <div class="govuk-grid-row" id="header" style="padding-top:16px;">
        <div class="govuk-grid-column-two-thirds">
          <h3 class="govuk-heading-m" style="margin-bottom: 8px;">Holmeland Farm</h3>
          <p class="govuk-hint sbi-number" style="margin-bottom: 8px;">
            Single Business Identifier (SBI): 123456789<br>Claim number: 123456789
          </p>
        </div>
        <div class="govuk-grid-column-one-third">
          <form class="form" action="saved-application" method="post">
            <button type="submit" class="govuk-button govuk-button--secondary" style="float:right; margin-bottom: 8px;"data-module="govuk-button">
              Save and return later
            </button>
          </form>
        </div>
  </div>
  <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">

{% endblock %}

{% block content %}

<div class="govuk-grid-row">

  <div class="govuk-grid-column-two-thirds">

    <!---success banner--->
    <div class="govuk-notification-banner govuk-notification-banner--success govuk-!-margin-bottom-6" role="alert" aria-labelledby="govuk-notification-banner-title" data-module="govuk-notification-banner">
      <div class="govuk-notification-banner__header">
        <h2 class="govuk-notification-banner__title" id="govuk-notification-banner-title">
          Success
        </h2>
      </div>
      <div class="govuk-notification-banner__content">
        <h3 class="govuk-notification-banner__heading">
          Your invoice details have been saved
        </h3>
      </div>
    </div>


      <h1 class="govuk-heading-l">
        <span class="govuk-caption-l">Add or view invoice</span>
        LV2: Livestock handling facilities
      </h1>
      <h2 class="govuk-heading-m" style="margin-bottom: 30px;">Parcel number: SD3578 7755</h2>


  </div>


<div class="govuk-grid-column-full">
  <table class="govuk-table">
    <thead class="govuk-table__head">
      <tr class="govuk-table__row">

        <th scope="col" class="govuk-table__header" style="width: 160px;">Receipt invoice reference</th>
        <th scope="col" class="govuk-table__header" style="width: 140px;">Total invoice amount (ex. VAT for approved works)</th>
        <th scope="col" class="govuk-table__header" style="width: 140px;">Total invoice VAT for approved works</th>
        <th scope="col" class="govuk-table__header" style="width: 140px;">Agreed payment rate</th>
        <th scope="col" class="govuk-table__header" style="width: 140px;">Total claimed value  ex. VAT</th>
        <th scope="col" class="govuk-table__header" style="width: 140px;">Total VAT claimed</th>
      </tr>
    </thead>

    <tbody class="govuk-table__body">

    <tr class="govuk-table__row" id="session-total-row" style="display: none;">
        <td class="govuk-table__cell">RCPT2023001</td>
        <td class="govuk-table__cell">£1,080.00</td>
        <td class="govuk-table__cell">£216.00</td>
        <td class="govuk-table__cell">100%</td>
      <td class="govuk-table__cell" id="session-claimed-amount"></td>
      <td class="govuk-table__cell" id="session-claimed-vat"></td>
    </tr>

      <tr class="govuk-table__row">

        <td class="govuk-table__cell"></td>
        <td class="govuk-table__cell"></td>
        <td class="govuk-table__cell"></td>
        <td class="govuk-table__cell" colspan="2" style="text-align: right;"><strong>Total claimed amount</strong></td>
        <td class="govuk-table__cell" id="total-claimed-value">£0.00</td>
      </tr>





      </tbody>
    </table>



    <form class="form" action="actual-cost-add-invoice" method="post">
      <button type="submit" class="govuk-button govuk-button--primary" data-module="govuk-button">
          Add invoice
      </button>
    </form>

      <form class="form" action="actual-cost-lv2-saved" method="post">
        <button type="submit" class="govuk-button govuk-button--secondary" data-module="govuk-button">
           Save and continue
        </button>
      </form>


</div>
</div>

<script>
  const amount = sessionStorage.getItem('amountClaimed');
  const vat = sessionStorage.getItem('vatClaimed');

  if (amount !== null || vat !== null) {
    const amountValue = parseFloat(amount) || 0;
    const vatValue = parseFloat(vat) || 0;
    const total = amountValue + vatValue;

    // Save total to sessionStorage for use on other pages
    sessionStorage.setItem('totalClaimed', total.toFixed(2));

    // Populate the session row
    document.getElementById('session-claimed-amount').textContent = `£${amountValue.toLocaleString('en-GB', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
    document.getElementById('session-claimed-vat').textContent = `£${vatValue.toLocaleString('en-GB', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
    document.getElementById('session-total-row').style.display = '';

    // Populate the final total row
    const totalCell = document.getElementById('total-claimed-value');
    if (totalCell) {
      totalCell.textContent = `£${total.toLocaleString('en-GB', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
    }
  }
</script>






{% endblock %}
